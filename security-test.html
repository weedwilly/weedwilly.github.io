<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Security Test Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 2rem; background-color: #f8f9fa; }
    .card { box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .result-box { white-space: pre-wrap; background: #fff; border: 1px solid #ccc; padding: 1rem; margin-top: 1rem; }
  </style>
</head>
<body>
  <h1 class="mb-4">🛡️ 資安測試挑戰頁面</h1>

  <!-- XSS Test -->
  <div class="card mb-4">
    <div class="card-header">🧪 XSS 測試</div>
    <div class="card-body">
      <input id="xssInput" class="form-control mb-2" placeholder="輸入可能的 XSS 攻擊碼">
      <button class="btn btn-danger" onclick="runXSS()">送出</button>
      <div id="xssOutput" class="result-box"></div>
    </div>
  </div>

  <!-- Clickjacking Test -->
  <div class="card mb-4">
    <div class="card-header">🕵️ Clickjacking 測試</div>
    <div class="card-body">
      <p>下方 iframe 嘗試嵌入主頁：</p>
      <iframe src="https://weedwilly.github.io/" width="300" height="200" style="border:1px solid #ccc;"></iframe>
    </div>
  </div>

  <!-- Input Flooding Test -->
  <div class="card mb-4">
    <div class="card-header">🌊 Input Flooding 測試</div>
    <div class="card-body">
      <button class="btn btn-warning" onclick="flood()">大量送出</button>
      <div id="floodStatus" class="text-muted mt-2"></div>
    </div>
  </div>

  <!-- CORS Test -->
  <div class="card mb-4">
    <div class="card-header">🌐 CORS 測試</div>
    <div class="card-body">
      <button class="btn btn-primary" onclick="testCORS()">測試跨網域請求</button>
      <div id="corsResult" class="result-box"></div>
    </div>
  </div>

  <!-- CSP Test -->
  <div class="card mb-4">
    <div class="card-header">🔒 CSP 測試</div>
    <div class="card-body">
      <p>請使用瀏覽器 DevTools 查看是否有 <code>Content-Security-Policy</code> headers。</p>
      <p>建議使用 <a href="https://observatory.mozilla.org/" target="_blank">Mozilla Observatory</a> 進行掃描。</p>
    </div>
  </div>

  <script>
    function runXSS() {
      const input = document.getElementById('xssInput').value;
      document.getElementById('xssOutput').innerHTML = input; // 故意使用 innerHTML
    }

    async function flood() {
      let count = 0;
      for (let i = 0; i < 100; i++) {
        await fetch('https://script.google.com/macros/s/你的AppsScript網址/exec', {
          method: 'POST',
          body: new URLSearchParams({ msg: 'flood ' + i })
        });
        count++;
        document.getElementById('floodStatus').textContent = `已送出 ${count} 筆資料`;
      }
    }

    async function testCORS() {
      try {
        const res = await fetch('https://你的Supabase或AppsScript網址', {
          method: 'GET',
          mode: 'cors'
        });
        const text = await res.text();
        document.getElementById('corsResult').textContent = text;
      } catch (err) {
        document.getElementById('corsResult').textContent = '錯誤：' + err;
      }
    }
  </script>
</body>
</html>
